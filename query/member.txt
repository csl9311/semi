--CREATE USER CONO IDENTIFIED BY CONO;
--GRANT RESOURCE, CONNECT TO CONO;
--GRANT CREATE VIEW TO CONO;

SELECT * FROM ALL_CONSTRAINTS;

DROP TABLE ADDRESS CASCADE CONSTRAINT;
DROP TABLE MEMBER CASCADE CONSTRAINT;
DROP TABLE GRADE CASCADE CONSTRAINT;
DROP SEQUENCE SEQ_ADDRESS_CODE;


CREATE SEQUENCE SEQ_ADDRESS_CODE;

CREATE TABLE GRADE(GRADE_CODE NUMBER PRIMARY KEY,GRADE VARCHAR2(9) NOT NULL);
CREATE TABLE MEMBER(
	ID VARCHAR2(30) PRIMARY KEY,
	PW VARCHAR2(300) NOT NULL,
	NAME VARCHAR2(15) NOT NULL,
    NICKNAME VARCHAR2(30) UNIQUE NOT NULL,
	PHONE VARCHAR2(13) NOT NULL,
	GENDER VARCHAR2(1) NOT NULL,
	EMAIL VARCHAR2(20) NOT NULL,
	STATUS VARCHAR2(1) DEFAULT 'Y',
    BIRTH DATE NOT NULL,
	REGDATE DATE,
	MODIFYDATE DATE,
    POINT NUMBER DEFAULT 0,
    NEWS NUMBER,
    SMS NUMBER,
    GRADE_CODE NUMBER REFERENCES GRADE(GRADE_CODE)
);
CREATE TABLE ADDRESS(
	ADDRESS_CODE NUMBER PRIMARY KEY,
	POSTNUM VARCHAR2(5),
	ROADADDRESS VARCHAR2(300),
    JIBUNADDRESS VARCHAR2(300),
    ADDRESS_DETAIL VARCHAR2(300),
    STATUS VARCHAR(1) DEFAULT 'Y',
    ID VARCHAR2(30) REFERENCES MEMBER(ID)
);
SELECT * FROM ADDRESS;


INSERT INTO GRADE VALUES(1, '일반');
INSERT INTO GRADE VALUES(2, '사장님');
INSERT INTO GRADE VALUES(3, '관리자');
INSERT INTO GRADE VALUES(4, '휴면');
INSERT INTO GRADE VALUES(5, '블랙');
INSERT INTO MEMBER VALUES('admin', '1ARVn2Auq2/WAqx2gNrL+q3RNjAzXpUfCXrzkA6d4Xa22yhRLy4AC50E+6UTPoscbo31nbOoq51gvkuXzJ6B2w==', 'name', '관리자', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 3);
INSERT INTO MEMBER VALUES('csl931', '1ARVn2Auq2/WAqx2gNrL+q3RNjAzXpUfCXrzkA6d4Xa22yhRLy4AC50E+6UTPoscbo31nbOoq51gvkuXzJ6B2w==', '최성락', '최성락', '010-4645-9876', 'M', 'csl9311@naver,com', DEFAULT, '1993-11-06', SYSDATE, SYSDATE, DEFAULT, 1 ,1, 3);

INSERT INTO ADDRESS VALUES(SEQ_ADDRESS_CODE.NEXTVAL, '06234', '서울 강남구 테헤란로14길 6', '서울 강남구 역삼동 823-24', '2층, 3층', DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(SEQ_ADDRESS_CODE.NEXTVAL, '05551', '서울 송파구 올림픽로 300', '서울 송파구 신천동 29', '3층', DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(SEQ_ADDRESS_CODE.NEXTVAL, '05554', '서울 송파구 올림픽로 240', '서울 송파구 잠실동 40-1', '', DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(SEQ_ADDRESS_CODE.NEXTVAL, 'csl931', '서울시 광진구 능동로 49길 20-5', '서울 광진구 중곡동 220-32', '101호', DEFAULT, 'csl931');
CREATE TABLE ADDRESS(
	ADDRESS_CODE NUMBER PRIMARY KEY,
	POSTNUM VARCHAR2(5),
	ROADADDRESS VARCHAR2(300),
    JIBUNADDRESS VARCHAR2(300),
    ADDRESS_DETAIL VARCHAR2(300),
    STATUS VARCHAR(1) DEFAULT 'Y',
    ID VARCHAR2(30) REFERENCES MEMBER(ID)
);
SELECT * FROM ADDRESS;
SELECT * FROM GRADE;
SELECT * FROM MEMBER;
commit;

-- 관리자 회원정보조회 뷰
CREATE OR REPLACE VIEW MEMBER_VIEW
AS
SELECT *
FROM MEMBER
    JOIN GRADE USING(GRADE_CODE)
WHERE STATUS = 'Y';

select * from MEMBER_VIEW;

-- 주소 조회 뷰
CREATE OR REPLACE VIEW ADDRESS_VIEW
AS SELECT ADDRESS_CODE,
          NVL(POSTNUM,'-')"POSTNUM",
          NVL(ROADADDRESS,'-')"ROADADDRESS",
          NVL(JIBUNADDRESS,'-')"JIBUNADDRESS",
          NVL(ADDRESS_DETAIL,'-')"ADDRESS_DETAIL",
          ID
FROM ADDRESS
WHERE STATUS='Y';
SELECT * FROM ADDRESS_VIEW;
commit;
